"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var dbname="mws",objectStore="mwsObjectStore",DBHelper=function(){function i(){_classCallCheck(this,i)}return _createClass(i,null,[{key:"initDB",value:function(){var e=window.indexedDB.open(dbname,1);return e.onupgradeneeded=function(){e.result.createObjectStore(objectStore,{keyPath:"id"})},e}},{key:"storeDataToDB",value:function(e){var n=i.initDB();n.onsuccess=function(){var t=n.result.transaction(objectStore,"readwrite").objectStore(objectStore);e.forEach(function(e){t.put(e)})}}},{key:"getDataFromDB",value:function(u,o){var a=i.initDB();a.onsuccess=function(){var e=a.result,t=e.transaction(objectStore,"readwrite"),n=t.objectStore(objectStore),r=n.getAll();u&&(r=n.get(u)),r.onsuccess=function(){o(r.result)},t.oncomplete=function(){e.close()}}}},{key:"fetchRestaurants",value:function(t){i.getDataFromDB(null,function(e){e&&t(null,e),fetch(i.DATABASE_URL).then(function(e){return e.json()}).then(function(e){t(null,e),i.storeDataToDB(e)}).catch(function(e){t(e,null)})})}},{key:"fetchRestaurantById",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.find(function(e){return e.id===r});n?u(null,n):u("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.filter(function(e){return e.cuisine_type===r});u(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,u){i.fetchRestaurants(function(e,t){if(e)u(e,null);else{var n=t.filter(function(e){return e.neighborhood===r});u(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,u,o){i.fetchRestaurants(function(e,t){if(e)o(e,null);else{var n=t;"all"!==r&&(n=n.filter(function(e){return e.cuisine_type===r})),"all"!==u&&(n=n.filter(function(e){return e.neighborhood===u})),o(null,n)}})}},{key:"fetchNeighborhoods",value:function(u){i.fetchRestaurants(function(e,n){if(e)u(e,null);else{var r=n.map(function(e,t){return n[t].neighborhood}),t=r.filter(function(e,t){return r.indexOf(e)===t});u(null,t)}})}},{key:"fetchCuisines",value:function(u){i.fetchRestaurants(function(e,n){if(e)u(e,null);else{var r=n.map(function(e,t){return n[t].cuisine_type}),t=r.filter(function(e,t){return r.indexOf(e)===t});u(null,t)}})}},{key:"urlForRestaurant",value:function(e){return"./restaurant.html?id="+e.id}},{key:"imageUrlForRestaurant",value:function(e,t){switch(t){case"large":return"/img/"+e.id+"-large.jpg";case"medium":return"/img/"+e.id+"-medium.jpg";default:return"/img/"+e.id+"-small.jpg"}}},{key:"mapMarkerForRestaurant",value:function(e,t){if(window.google)return new google.maps.Marker({position:e.latlng,title:e.name,url:i.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),i}();
//# sourceMappingURL=dbhelper.js.map
